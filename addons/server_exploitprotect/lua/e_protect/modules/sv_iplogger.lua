local function handleIPLoggin(ply, ip)
    local sid64 = ply:SteamID64()
    http.Fetch("http://ip-api.com/json/"..ip, function(json)
        json = util.JSONToTable(json)
        local result = json["countryCode"]

        if !result then result = "N/A" end

        eProtect.registerIP(sid64, ip, result)
    end, function()
        eProtect.registerIP(sid64, ip, "N/A")
    end)
end

hook.Add("PlayerInitialSpawn", "eP:IPLogging", function(ply)
    if ply:IsBot() then return end
    local ip = ply:IPAddress()
    
    local tblstr = string.ToTable(ip)

    ip = ""
    for k,v in pairs(tblstr) do
        if v == ":" then break end

        ip = ip..v
    end

    handleIPLoggin(ply, ip)
end)